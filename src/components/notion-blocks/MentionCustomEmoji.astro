---
import { Image } from "astro:assets";
import type { Mention } from "@/lib/interfaces.ts";
import { filePath, getNotionImage, getImageComponentFormat } from "@/lib/blog-helpers.ts";
import { file } from "astro/loaders";

export interface Props {
	mention: Mention;
}

const { mention } = Astro.props;

if (!mention.CustomEmoji) {
	return null;
}

const { Name, Url } = mention.CustomEmoji;

if (!Url) {
	return null;
}

const downloadedEmoji = await getNotionImage(new URL(Url));
const externalEmojiPath = downloadedEmoji ? null : filePath(new URL(Url));
---

{
	downloadedEmoji ? (
		<Image
			src={downloadedEmoji}
			alt={`custom emoji with name ${Name}`}
			aria-label={`custom emoji with name ${Name}`}
			class="no-rss mb-0.5 inline h-4 w-4 object-contain align-sub text-transparent"
			format={getImageComponentFormat(downloadedEmoji)}
			widths={[100]}
			sizes="40px"
		/>
	) : (
		<img
			src={externalEmojiPath}
			alt={`custom emoji with name ${Name}`}
			aria-label={`custom emoji with name ${Name}`}
			class="no-rss mb-0.5 inline h-4 w-4 object-contain align-sub text-transparent"
		/>
	)
}
